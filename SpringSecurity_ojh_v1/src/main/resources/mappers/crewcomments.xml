<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
 <mapper namespace="crewcomments.CrewCommentsBean">
 	<insert id="InsertCrewComments">
 		insert into crew_comments(num, idx, writer, content, ref, re_level, re_step, reg_date)
 		values(ccmt_seq.nextval, #{idx}, #{writer}, #{content}, ccmt_seq.currval, 0, 0, sysdate)
 	</insert>
 	
 	<select id="GetCrewCommentsByIdx" resultType="com.spring.ex.crewcomments.model.CrewCommentsBean">
 		select num, idx, writer, content, ref, re_level, re_step, reg_date		        
		from (select rownum as rank, num, idx, writer, content, ref, re_level, re_step, reg_date
		from (select num, idx, writer, content, ref, re_level, re_step, reg_date 
		from crew_comments
		order by ref desc, re_step asc ))
		where idx = #{idx}
 	</select>
 	
 	<update id="UpdateOrginComment">
 		update crew_comments
 		set re_step=#{restep}+1 
 		where ref=#{ref} and re_step>#{restep}
 	</update>
 	
 	<insert id="InsertReplyCrewComments">
 		insert into crew_comments(num, idx, writer, content, ref, re_level, re_step, reg_date)
 		values(ccmt_seq.nextval, #{idx}, #{writer}, #{content}, #{ref}, #{relevel}, #{restep}, sysdate)
 	</insert>
 </mapper>